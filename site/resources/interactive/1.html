<div id="episode1-interactive" style="width:100%;">
	<div id="battleground-map" style="display:block; float:left; width: 50%;"></div>
	<div id="battleground-names" style="display:block; float:left; width: 50%; text-align: left; color:#fff;">
		<h2>CARBON BATTLEGROUNDS</h2>
		<h3><h3>
		<p></p>
	</div>
	<script>
	var width = 560,
		height = 560;

	var projection = d3.geo.orthographic()
		.translate([width / 2, height / 2])
		.scale(width / 2 - 20)
		.clipAngle(90)
		.precision(0.6);
		
	var graticule = d3.geo.graticule();

	var canvas = d3.select("#episode1-interactive #battleground-map").append("canvas")
		.attr("width", width)
		.attr("height", height);

	var c = canvas.node().getContext("2d");

	var g = canvas.append("g");

	var locations = canvas.append('canvas')
		.attr('id', 'locations');

	var path = d3.geo.path()
		.projection(projection)
		.context(c);

	var title = d3.select("#battleground-names h3");
	var desc = d3.select("#battleground-names p");

	queue()
		.defer(d3.json, "json/world-110m.json")
		.defer(d3.tsv, "json/battleground-countries.tsv")
		.await(ready);

	function ready(error, world, names) {
	  if (error) throw error;

	  var globe = {type: "Sphere"},
		  land = topojson.feature(world, world.objects.land),
		  countries = topojson.feature(world, world.objects.countries).features,
		  borders = topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }),
		  i = -1,
		  n = countries.length,
		  grid = graticule();

	  countries = countries.filter(function(d) {
		return names.some(function(n) {
		  if (d.id == n.id) return d.name = n.name;
		});
	  }).sort(function(a, b) {
		return a.name.localeCompare(b.name);
	  });

	  (function transition() {
		d3.transition()
			.duration(2250)
			.each("start", function() {
			  title.text(countries[i = (i + 1) % n].name);
			  console.log(countries[i = (i + 1) % n]);
			  //desc.text(countries[i = (i + 1) % n].desc);
			})
			.tween("rotate", function() {
			  var p = d3.geo.centroid(countries[i]),
				  r = d3.interpolate(projection.rotate(), [-p[0], -p[1]]);
			  return function(t) {
				projection.rotate(r(t));
				c.clearRect(0, 0, width, height);
				
				c.fillStyle = "#fff", c.beginPath(), path(globe), c.fill();
				
				c.beginPath();
				path(grid);
				c.lineWidth = .5;
				c.strokeStyle = "rgba(119,119,119,.5)";
				c.stroke();										
				
				c.fillStyle = "#222", c.beginPath(), path(land), c.fill();
				c.fillStyle = "#f00", c.beginPath(), path(countries[i]), c.fill();
				c.strokeStyle = "#fff", c.lineWidth = 1, c.beginPath(), path(borders), c.stroke();
				//c.strokeStyle = "#fff", c.lineWidth = 20, c.beginPath(), path(globe), c.stroke();
				
			  };
			})
		  .transition()
			.each("end", transition);
	  })();
	  
	}

	d3.select(self.frameElement).style("height", height + "px");
	</script>				

</div>